
globals:
  javascript: |
    // retrieves the hostname from the specified server
    function getHostname(server){
      return server == 'LOCAL' ? 'localhost' : server.split('@').pop()
    }

scripts:
  install-mise: #https://mise.jdx.dev/getting-started.html
    - sh:
        command: mise help
        silent: true
        ignore-exit-code: true
    - regex: ".*command not found"
      then:
        - sh: curl https://mise.run | sh
          then:
            - regex: "installed successfully"
              else:
                - abort: failed to install Mise

  select-java:
    - script: install-mise
    - sh: mise use -g java@${{JAVA_VERSION:temurin-21.0.5+11.0.LTS}}
    # mainly for debugging purposes
    - sh: java -version

  extract-pid-from-container:
    # CONTAINER_POD_ID: the id of the running container
    # STATE_PID: the state where the pid should be saved to
    - sh: ${{CONTAINER_RUNTIME}} inspect --format='{{.State.Pid}}' ${{CONTAINER_POD_ID}}
    - regex: (^[1-9][0-9]*$)
      then:
        - set-state: ${{STATE_PID}}